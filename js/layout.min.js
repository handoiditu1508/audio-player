let inputId="audioInput",listElements=[],playOrder=[],playOrderIndex=null,isShuffled=!1,autoPlayTimeoutId=null;function getInputAudios(){return document.getElementById(inputId).files}function getPlayer(){return document.getElementById("player")}function getList(){return document.getElementById("playList")}function getPreviousBtn(){return document.getElementById("previousBtn")}function getNextBtn(){return document.getElementById("nextBtn")}function getShuffleBtn(){return document.getElementById("shuffleBtn")}function getUnshuffleBtn(){return document.getElementById("unshuffleBtn")}function isAutoPlay(){return document.getElementById("autoPlay").checked}function getTimeBetweenSongs(){let seconds=parseFloat(document.getElementById("timeBetweenSongs").value);return isNaN(seconds)&&(seconds=0),seconds}function stopAutoPlayTimeout(){null!=autoPlayTimeoutId&&(clearTimeout(autoPlayTimeoutId),autoPlayTimeoutId=null)}function setFileName(name){document.getElementById("fileName").innerHTML=name,window.document.title=name}function play(index){stopAutoPlayTimeout();let files=getInputAudios();if(FileReader&&files&&files.length>index){let fr=new FileReader,player=getPlayer();fr.onload=function(){player.src=fr.result,player.play(),enableBtns()},fr.readAsDataURL(files[index])}}function playNext(){playOrder[playOrderIndex].classList.remove("playing"),playOrder.length>playOrderIndex+1?playOrderIndex++:playOrderIndex=0,play(playOrder[playOrderIndex].getAttribute("index")),playOrder[playOrderIndex].classList.add("playing"),setFileName(playOrder[playOrderIndex].innerHTML)}function playPrevious(){playOrder[playOrderIndex].classList.remove("playing"),-1<playOrderIndex-1?playOrderIndex--:playOrderIndex=playOrder.length-1,play(playOrder[playOrderIndex].getAttribute("index")),playOrder[playOrderIndex].classList.add("playing"),setFileName(playOrder[playOrderIndex].innerHTML)}function shuffleList(){for(let i=playOrder.length-1;i>0;i--){let j=Math.floor(Math.random()*(i+1));[playOrder[i],playOrder[j]]=[playOrder[j],playOrder[i]],i==playOrderIndex?playOrderIndex=j:j==playOrderIndex&&(playOrderIndex=i)}[playOrder[playOrderIndex],playOrder[0]]=[playOrder[0],playOrder[playOrderIndex]],playOrderIndex=0,isShuffled=!0}function unshuffleList(){playOrderIndex=parseInt(playOrder[playOrderIndex].getAttribute("index")),playOrder=[...listElements],isShuffled=!1}function handleListItemClickEvent(element){disableBtns();let index=parseInt(element.getAttribute("index"));if(play(index),playOrder[playOrderIndex].classList.remove("playing"),element.classList.add("playing"),setFileName(listElements[index].innerHTML),isShuffled){let elementOrderIndex=playOrder.indexOf(element);elementOrderIndex<playOrderIndex?[playOrder[elementOrderIndex],playOrder[playOrderIndex]]=[playOrder[playOrderIndex],playOrder[elementOrderIndex]]:[playOrder[elementOrderIndex],playOrder[++playOrderIndex]]=[playOrder[playOrderIndex],playOrder[elementOrderIndex]]}else playOrderIndex=index}function disableBtns(){getNextBtn().disabled=!0,getPreviousBtn().disabled=!0,getShuffleBtn().disabled=!0,getUnshuffleBtn().disabled=!0;for(let i=0;i<listElements.length;i++)listElements[i].setAttribute("onmouseup",null)}function enableBtns(){getNextBtn().disabled=!1,getPreviousBtn().disabled=!1,getShuffleBtn().disabled=!1,getUnshuffleBtn().disabled=!1;for(let i=0;i<listElements.length;i++)listElements[i].setAttribute("onmouseup","handleListItemClickEvent(this)")}getNextBtn().addEventListener("mouseup",()=>{disableBtns(),listElements.length&&playNext()}),getPreviousBtn().addEventListener("mouseup",()=>{disableBtns(),listElements.length&&playPrevious()}),getShuffleBtn().addEventListener("mouseup",event=>{disableBtns(),listElements.length&&(shuffleList(),event.target.innerHTML="Reshuffle"),enableBtns()}),getUnshuffleBtn().addEventListener("mouseup",()=>{disableBtns(),listElements.length&&(unshuffleList(),getShuffleBtn().innerHTML="Shuffle"),enableBtns()}),document.getElementById(inputId).addEventListener("change",evt=>{disableBtns();let tgt,files=(evt.target||window.event.srcElement).files,firstPlayIndex=0;if(!(FileReader&&files&&files.length))return void alert("Not supported");{let fr=new FileReader;fr.onload=function(){getPlayer().src=fr.result,enableBtns()},fr.readAsDataURL(files[0])}let isShuffled=!1;getShuffleBtn().innerHTML="Shuffle";let list=getList();list.innerHTML="";let listItems=document.createElement("DIV");for(i=0;i<files.length;i++){let listItem=document.createElement("LI");listItem.classList.add("media-list-item"),listItem.setAttribute("index",i);let name=files[i].name;name=name.substring(0,name.lastIndexOf(".")),listItem.innerHTML=name,0==i&&(listItem.classList.add("playing"),setFileName(name)),listItem.setAttribute("onmouseup","handleListItemClickEvent(this)"),listItems.appendChild(listItem)}list.innerHTML=listItems.innerHTML,listElements=[...list.children],playOrder=[...listElements],playOrderIndex=0}),getPlayer().addEventListener("ended",(function(event){isAutoPlay()&&playOrder.length>playOrderIndex+1&&(autoPlayTimeoutId=setTimeout((function(){disableBtns(),playOrder[playOrderIndex].classList.remove("playing"),play(playOrder[++playOrderIndex].getAttribute("index")),playOrder[playOrderIndex].classList.add("playing"),setFileName(playOrder[playOrderIndex].innerHTML)}),1e3*getTimeBetweenSongs()))}));